<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<title>.eunit/event_fsm.COVER.html</title>
</head><body style='background-color: white; color: black'>
<pre>
File generated from /Users/gregor/tika_server/.eunit/event_fsm.erl by COVER 2014-12-28 at 13:57:17

****************************************************************************

        |  -module(event_fsm).
        |  -behaviour(gen_fsm).
        |  
        |  %% public API
        |  -export([start/1, start_link/1, 
        |  				confirm_date/2, 
        |  				deconfirm_date/2, 
        |  				reject/2,
        |  				edit/2,
        |  				fix/2,
        |  				over/1,
        |  				stop/2]).
        |  %% gen_fsm callbacks
        |  -export([init/1, handle_event/3, handle_sync_event/4, handle_info/3,
        |  			terminate/3, code_change/4,
        |  			% custom state names
        |  			open/2,
        |  			fixed/2]).
        |  
        |  -include("records.hrl").
        |  
        |  
        |  -type event() :: #event {}.
        |  -type user() :: #user {}.
        |  
        |  
        |  %%% PUBLIC API
        |  start(Event=#event{}) -&gt;
<font color=red>     0..|  	gen_fsm:start(?MODULE, Event, []).</font>
        |   
        |  start_link(Event=#event{}) -&gt;
     2..|  	gen_fsm:start_link(?MODULE, Event, []).
        |  
        |  %%% EVENTS
        |  confirm_date(OwnPid,{User,Day_ts}) -&gt;
     1..|  	gen_fsm:send_event(OwnPid,{confirm_date,User,Day_ts}).
        |  
        |  deconfirm_date(OwnPid,{User,Day_ts}) -&gt;
     1..|  	gen_fsm:send_event(OwnPid,{deconfirm_date,User,Day_ts}).
        |  
        |  reject(OwnPid,{User}) -&gt;
     2..|  	gen_fsm:send_event(OwnPid,{reject,User}).
        |  
        |  edit(OwnPid,{title,Title}) -&gt;
     1..|  	gen_fsm:send_event(OwnPid,{edit,title,Title});
        |  edit(OwnPid,{description,Description}) -&gt;
     1..|  	gen_fsm:send_event(OwnPid,{edit,description,Description});
        |  edit(OwnPid,{addContact,User=#user{}}) -&gt;
     1..|  	gen_fsm:send_event(OwnPid,{edit,addContact,User});
        |  edit(OwnPid,{removeContact,User=#user{}}) -&gt;
     1..|  	gen_fsm:send_event(OwnPid,{edit,removeContact,User});
        |  edit(OwnPid,{addDate,Day=#day{}}) -&gt;
     1..|  	gen_fsm:send_event(OwnPid,{edit,addDate,Day});
        |  edit(OwnPid,{removeDate,Day=#day{}}) -&gt;
     1..|  	gen_fsm:send_event(OwnPid,{edit,removeDate,Day}).
        |  
        |  
        |  fix(OwnPid,{Day}) -&gt;
     1..|  	gen_fsm:send_event(OwnPid,{fix,Day}).
        |  
        |  over(OwnPid) -&gt;
     1..|  	gen_fsm:send_event(OwnPid,over).
        |  
        |  %% stop the event.
        |  stop(OwnPid,cancel) -&gt;
     2..|      gen_fsm:send_all_state_event(OwnPid, cancel).
        |  
        |  %%% GEN_FSM API
        |  
        |  %% Set Event FSM to open state
        |  -spec init(Event::event()) -&gt; {ok, open, event()}.
        |  init(Event=#event{}) -&gt;
     2..|  	{ok, open, Event}.
        |  
        |  %%% STATE CALLBACKS
        |  -spec open({confirm_date, User::user(), Day_ts::non_neg_integer()}, Event::event()) -&gt;  {next_state,open,event()}.
        |  open({confirm_date,User=#user{},Day_ts},Event=#event{}) -&gt;
     1..|  	ModEvent=event:add_user_to_event(Event,User,Day_ts),
     1..|  	notice(ModEvent,"Add User To Event",[Day_ts]),
     1..|  	{next_state,open,ModEvent};
        |  
        |  open({deconfirm_date,User=#user{},Day_ts},Event=#event{}) -&gt;
        |  	%%remove user from day
     1..|  	ModEvent=event:remove_user_from_event(Event,User,Day_ts),
     1..|  	notice(ModEvent,"Remove User From Event",[Day_ts]),
     1..|  	{next_state,open,ModEvent};
        |  
        |  open({reject,User=#user{}},Event=#event{}) -&gt;
     2..|  	reject_event(User,Event);
        |  
        |  open({edit,title,Title},Event=#event{}) -&gt;
     1..|  	ModEvent=event:edit(Event,{title,Title}),
     1..|  	notice(ModEvent,"Edit Event Title",[Title]),
     1..|  	{next_state,open,ModEvent};
        |  
        |  open({edit,description,Description},Event=#event{}) -&gt;
     1..|  	ModEvent=event:edit(Event,{description,Description}),
     1..|  	notice(ModEvent,"Edit Event Description",[Description]),
     1..|  	{next_state,open,ModEvent};
        |  
        |  open({edit,addContact,User=#user{}},Event=#event{}) -&gt;
     1..|  	ModEvent=event:edit(Event,{addContact,User}),
     1..|  	notice(ModEvent,"Edit Event add Contact",[User]),
     1..|  	{next_state,open,ModEvent};
        |  
        |  open({edit,removeContact,User=#user{}},Event=#event{}) -&gt;
     1..|  	ModEvent=event:edit(Event,{removeContact,User}),
     1..|  	notice(ModEvent,"Edit Event remove Contact",[User]),
     1..|  	{next_state,open,ModEvent};
        |  
        |  open({edit,addDate,Day=#day{}},Event=#event{}) -&gt;
     1..|  	ModEvent=event:edit(Event,{addDate,Day}),
     1..|  	notice(ModEvent,"Edit Event add Date",[Day]),
     1..|  	{next_state,open,ModEvent};
        |  
        |  open({edit,removeDate,Day=#day{}},Event=#event{}) -&gt;
     1..|  	ModEvent=event:edit(Event,{removeDate,Day}),
     1..|  	notice(ModEvent,"Edit Event remove Date",[Day]),
     1..|  	{next_state,open,ModEvent};
        |  
        |  open({fix,Day=#day{}},Event=#event{}) -&gt;
     1..|  	ModEvent=event:fix(Event,Day),
     1..|  	notice(ModEvent,"Event Fixed",[Day]),
     1..|  	{next_state,fixed,ModEvent};
        |  
        |  open(Event, Data) -&gt;
<font color=red>     0..|  	unexpected(Event, open),</font>
<font color=red>     0..|      {next_state, open, Data}.</font>
        |  
        |  fixed({reject,User=#user{}},Event=#event{}) -&gt;
<font color=red>     0..|  	reject_event(User,Event);</font>
        |  
        |  fixed(over, Event=#event{}) -&gt;
     1..|  	notice(Event,"Event is Over",[]),
     1..|      {stop, normal, Event};
        |  
        |  fixed(Event, Data) -&gt;
<font color=red>     0..|  	unexpected(Event, fixed),</font>
<font color=red>     0..|      {next_state, fixed, Data}.</font>
        |  
        |  
        |  %% This cancel event has been sent by the event owner
        |  %% stop whatever we're doing and shut down!
        |  handle_event(cancel, _StateName, Event=#event{}) -&gt;
<font color=red>     0..|      {stop, normal, Event};</font>
        |  handle_event(Event, StateName, Data) -&gt;
<font color=red>     0..|      unexpected(Event, StateName),</font>
<font color=red>     0..|      {next_state, StateName, Data}.</font>
        |  
        |  %% Note: DO NOT reply to unexpected calls. Let the call-maker crash!
        |  handle_sync_event(Event, _From, StateName, Data) -&gt;
<font color=red>     0..|      unexpected(Event, StateName),</font>
<font color=red>     0..|      {next_state, StateName, Data}.</font>
        |  
        |  %% can be used for down event
        |  handle_info(Info, StateName, Data) -&gt;
<font color=red>     0..|      unexpected(Info, StateName),</font>
<font color=red>     0..|      {next_state, StateName, Data}.</font>
        |  
        |  
        |  code_change(_OldVsn, StateName, Data, _Extra) -&gt;
<font color=red>     0..|   {ok, StateName, Data}.</font>
        |  
        |  %% Event over.
        |  terminate(normal, ready, Event=#event{}) -&gt;
<font color=red>     0..|      notice(Event, "FSM leaving.", []);</font>
        |  terminate(_Reason, _StateName, _StateData) -&gt;
     2..|      ok.
        |  
        |  %%% PRIVATE FUNCTIONS
        |  reject_event(User=#user{},Event=#event{}) -&gt;
     2..|  	ModEvent=event:reject_event(Event,User),
     2..|  	case lists:flatlength(ModEvent#event.contacts)&gt;0 of
        |  		false -&gt;
     1..|  			notice(ModEvent,"Stop Event-&gt; All User Rejected",[User]),
     1..|  			{stop, normal, Event};
        |  		true -&gt; 
     1..|  			notice(ModEvent,"User Rejected",[User]),
     1..|  			{next_state,open,ModEvent}
        |  	end.
        |  
        |  %% Unexpected allows to log unexpected messages
        |  unexpected(Msg, State) -&gt;
<font color=red>     0..|      io:format("~p received unknown event ~p while in state ~p~n",</font>
        |                [self(), Msg, State]).
        |  
        |  %% Send players a notice. This could be messages to their clients
        |  %% but for our purposes, outputting to the shell is enough.
        |  notice(Event=#event{}, Str, Args) -&gt;
    12..|      erlang:display(Str).
        |      %erlang:display(Event).
        |      %io:format("~n: "++Str++"~n", [Event|Args]).
</pre>
</body>
</html>
